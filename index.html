<!-- build:v2.5c-favicon-20251216102434Z -->
<!doctype html>
<html lang="en">
<head>
  <link rel="icon" href="data:,">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Workout Tracker</title>
<style>
:root {  --bg: #0b0c10;  --card: #12131a;  --line: rgba(255,255,255,.10);  --text: rgba(255,255,255,.92);  --muted: rgba(255,255,255,.65);  --muted2: rgba(255,255,255,.45);  --pill: rgba(255,255,255,.[...] 
}
* { box-sizing: border-box; }
html, body { height: 100%;   padding-bottom: max(24px, env(safe-area-inset-bottom));
}  body {  margin: 0;  min-height: 100svh;
  min-height: 100vh;  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;  color: var(--text);  background:  radial-gradient(1200px 600px at 10% -10%, rgba(255,255,255,.08),[...]
  padding-bottom: max(24px, env(safe-area-inset-bottom));
}
a { color: inherit; }
.wrap { max-width: 980px; margin: 18px auto 40px; padding: 0 14px; }
.topbar {  display:flex; gap: 12px; align-items:center; justify-content:space-between;  padding: 14px 14px; border: 1px solid var(--line); border-radius: 18px;  background: rgba(18,19,26,.75); backdro[...]
}
.brand { display:flex; gap: 10px; align-items:center; min-width: 240px; }
.dot { width: 10px; height: 10px; border-radius: 50%; background: rgba(255,255,255,.7); box-shadow: 0 0 0 6px rgba(255,255,255,.06); }
.brand h1 { margin: 0; font-size: 14px; letter-spacing: .2px; }
.brand p { margin: 2px 0 0; font-size: 12px; color: var(--muted2); }
.profileRow { display:flex; gap: 8px; align-items:center; flex-wrap: wrap; margin-top: 3px; }  .tabs{  display: inline-grid;  grid-auto-flow: row;  gap: 10px;  justify-items: stretch;  align-items: st[...]
}
.tab{  border: 1px solid var(--line);  background: rgba(255,255,255,.06);  color: var(--muted2);  padding: 8px 12px;  border-radius: 999px;  font-size: 12px;  text-align: center;  width: 100%;
}
.tab.active{  background: rgba(255,255,255,.12);  color: var(--text);
}
.main { margin-top: 14px; }
.card { background: rgba(18,19,26,.72); border: 1px solid var(--line); border-radius: 18px; padding: 14px; }
.stack > * + * { margin-top: 10px; }
.h2 { font-size: 16px; margin: 0 0 6px; }
.sub { margin: 0; font-size: 12px; color: var(--muted); line-height: 1.4; }
.row { display:flex; gap: 10px; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; }
.pill {  display:inline-flex; gap: 8px; align-items:center;  background: var(--pill); border: 1px solid var(--line);  padding: 6px 10px; border-radius: 999px;  font-size: 12px; color: var(--muted); wh[...]
}
.pill strong { color: var(--text); font-weight: 650; }
.pill.good { background: var(--good); }
.pill.warn { background: var(--warn); }
.pill.danger { background: var(--danger); }
.btn {  width: 100%; background: rgba(255,255,255,.12); border: 1px solid var(--line);  color: var(--text); padding: 10px 12px; border-radius: 14px;  font-size: 13px; cursor: pointer;
}
.btn.secondary { background: transparent; color: var(--muted); }
.btn.inline { width: auto; padding: 8px 10px; }
.grid2 { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
@media (max-width: 720px) {  .grid2 { grid-template-columns: 1fr; }  .brand { min-width: auto; }
}
.label { font-size: 12px; color: var(--muted2); margin: 0 0 4px; }
.kv { font-size: 14px; font-weight: 700; }
.hr { height: 1px; background: var(--line); margin: 8px 0; }
.sectionTitle { font-size: 12px; color: var(--muted2); margin: 10px 0 8px; }
.exerciseCard {  background: rgba(18,19,26,.84);  border: 1px solid var(--line);  border-radius: 16px;  padding: 12px;
}
.exerciseTitleRow { display:flex; justify-content: space-between; gap: 10px; align-items: flex-start; }
.exerciseTitle { font-size: 13px; font-weight: 750; margin: 0; cursor: pointer; }
.meta { font-size: 12px; color: var(--muted); }
.note { margin-top: 8px; font-size: 12px; color: var(--muted2); line-height: 1.35; }
.miniBtns { display:flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
.miniBtn {  border: 1px solid var(--line);  background: transparent;  color: var(--muted);  border-radius: 12px;  padding: 7px 9px;  font-size: 12px;  cursor: pointer;
}

.iconBtn {
  width: 34px;
  height: 34px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.06);
  color: rgba(255,255,255,.82);
  font-size: 16px;
  line-height: 1;
}
.iconBtn:active{ transform: translateY(1px); }
.iconBtn[disabled]{ opacity:.35; }
.setTable { width: 100%; border-collapse: collapse; margin-top: 10px; }
.setTable th {  text-align: left; font-size: 11px; color: var(--muted2);  font-weight: 650; padding: 8px 0; border-bottom: 1px solid var(--line);
}
.setTable td {  padding: 10px 0; border-bottom: 1px solid var(--line);  font-size: 12px; color: var(--muted); vertical-align: middle;
}
.setTable tr:last-child td { border-bottom: none; }
input {  width: 92px;  border-radius: 10px;  border: 1px solid var(--line);  background: rgba(255,255,255,.06);  color: var(--text);  padding: 8px 9px;  font-size: 12px;  outline: none;
}
input.small { width: 70px; }
.toast {  position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%);  background: rgba(18,19,26,.96);  border: 1px solid var(--line);  color: var(--text);  border-radius: 14px;  padding: 1[...]
}
.modalBackdrop {  position: fixed; inset: 0;  background: rgba(0,0,0,.55);  display:none; align-items:flex-end; justify-content:center;  padding: 18px;
}
.modal {  width: min(640px, 100%);  background: rgba(18,19,26,.98);  border: 1px solid var(--line);  border-radius: 18px;  padding: 14px;  box-shadow: 0 30px 90px rgba(0,0,0,.65);
}
select {  width: 100%;  border-radius: 12px;  border: 1px solid var(--line);  background: rgba(255,255,255,.06);  color: var(--text);  padding: 10px 10px;  font-size: 13px;
}
.modalActions { display:flex; gap: 8px; justify-content:flex-end; flex-wrap: wrap; margin-top: 12px; }
.chartBox {  width: 100%;  border-radius: 16px;  border: 1px solid var(--line);  background: rgba(255,255,255,.05);  padding: 10px;
}
.listItem {  display:flex; justify-content:space-between; gap: 10px;  padding: 10px 0; border-top: 1px solid var(--line);  font-size: 12px; color: var(--muted);
}
.listItem:first-of-type { border-top: none; padding-top: 2px; }
.smallMuted { color: var(--muted2); }
.badge {  display:inline-flex; align-items:center; gap: 6px;  border-radius: 999px; border: 1px solid var(--line);  background: rgba(255,255,255,.08);  padding: 6px 10px; font-size: 12px; color: var(-[...]
}  .draftIndicator{  font-size: 11px;  color: var(--muted2);  text-align: right;  padding-top: 2px;  min-width: 110px;
}
.draftIndicator .miniDot{  width: 6px; height: 6px; border-radius: 50%;  display:inline-block; margin-right:6px; vertical-align: middle;  background: rgba(255,255,255,.35);
}
.draftIndicator.saving{ color: rgba(255,255,255,.55); }
.draftIndicator.saved{ color: rgba(255,255,255,.55); }
.draftIndicator.error{ color: rgba(255,170,170,.78); }  </style>
</head>
<body>
<div class="wrap">  <div class="topbar">  <div class="brand">  <div class="dot"></div>  <div>  <h1>Workout Tracker</h1>  <div id="statusLine" class="profileRow"><span class="sub">Signing in…</span><[...]
</div>  <div id="toast" class="toast"></div>  <div id="modal-picker" class="modalBackdrop">  <div class="modal">  <div class="row">  <div>  <div style="font-size:13px; font-weight:800;">Jump to Week/D[...]
</div>  <div id="modal-sub" class="modalBackdrop">  <div class="modal">  <div class="row">  <div>  <div style="font-size:13px; font-weight:800;" id="subTitle">Substitute</div>  <div class="sub">Pick w[...]
</div>  <script>
(function(){  function ensureDebugPanel(){  let el = document.getElementById('bootDebug');  if(el) return el;  el = document.createElement('div');  el.id = 'bootDebug';  el.style.position='fixed';  el[...]
})();
</script>  <script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js';
import { getAuth, onAuthStateChanged, signInAnonymously } from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js';
import {  getFirestore, doc, setDoc, getDoc, collection, serverTimestamp,  writeBatch, query, orderBy, limit, getDocs, deleteDoc
} from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js';
/* Program baked into HTML (V1) */
const PROGRAM = {"name": "P3 Intermediate-Advanced", "weeks": {"1": {"week": 1, "block": "Foundation", "days": {"1": {"day": 1, "workout": "Upper (Strength Focus)", "isRest": false, "exercises": [{...}]}}}};
const firebaseConfig = {  apiKey: "AIzaSyAJfPSMoQUArHJ1v_jxZXWIQG8Or4CtUTM",  authDomain: "workout-tracker-98f8c.firebaseapp.[...] 
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);  /* UI helpers */
const $ = (sel) => document.querySelector(sel);
const screens = {  home: $('#screen-home'),  workout: $('#screen-workout'),  exercise: $('#screen-exercise'),  program: $('#screen-program'),
};
const tabs = Array.from(document.querySelectorAll('.tab'));
const statusLine = $('#statusLine');
const draftUi = { state: 'idle', lastSavedAt: null, lastError: null };
function renderDraftIndicator() {  const el = document.getElementById('draftIndicator');  if (!el) return;  el.classList.remove('saving','saved','error');  if (draftUi.state === 'saving') {  el.classL[...]
}  async function copyProfileLink() {  try {  await navigator.clipboard.writeText(window.location.href);  showToast('Link copied.');  } catch {  showToast('Copy failed. Tap and hold the address bar to[...]
}  function showToast(msg, ms=2200) {  const t = $('#toast');  t.textContent = msg;  t.style.display = 'block';  clearTimeout(showToast._to);  showToast._to = setTimeout(() => (t.style.display = 'none[...]
}  function setRoute(route) {  tabs.forEach(b => b.classList.toggle('active', b.dataset.route === route));  Object.entries(screens).forEach(([k, el]) => {  el.style.display = (k === route) ? 'block' :[...]
}  tabs.forEach(b => b.addEventListener('click', () => {  const r = b.dataset.route;  if (r === 'workout' && !state.currentPlan) {  showToast('Pick a day first.');  return;  }  setRoute(r);  render();
}));  function normName(s) {  if (!s) return '';  return String(s).replace(/\s+/g,' ').trim();
}
function isRestDay(week, day) {  const d = PROGRAM.weeks?.[String(week)]?.days?.[String(day)];  return !!d?.isRest;
}
function getDayPlan(week, day) {  const w = PROGRAM.weeks?.[String(week)];  if (!w) return null;  const d = w.days?.[String(day)];  if (!d) return null;  return {  week: w.week,  block: w.block,  day:[...]
}
function listWeekDays(week) {  const w = PROGRAM.weeks?.[String(week)];  if (!w) return [];  const days = Object.values(w.days || {}).sort((a,b)=>a.day-b.day);  return days.map(d => ({ day: d.day, wor[...]
}
function findNextScheduled(week, day) {  const days = listWeekDays(week);  const idx = days.findIndex(d => d.day === day);  if (idx >= 0 && idx < days.length - 1) return { week, ...days[idx+1] };  con[...]
}
function advanceToNextWorkoutDay(week, day) {  let w = week, d = day;  for (let step = 0; step < 30; step++) {  const days = listWeekDays(w);  const idx = days.findIndex(x => x.day === d);  let next [...]
}
function parseRestUpper(restStr){  if(!restStr) return null;  const s = String(restStr).toLowerCase().trim();  // Examples: "90 sec", "2 min", "1-2 min", "1–2 min", "1 to 2 min"  const norm = s.repl[...]
}
function fmtTime(sec) {  const m = Math.floor(sec/60);  const s = sec % 60;  return `${m}:${String(s).padStart(2,'0')}`;
}
function fmtWeight(w) {  if (w === null || w === undefined || w === '') return '';  const n = Number(w);  if (!Number.isFinite(n)) return String(w);  return (Math.round(n*2)/2).toString();
}
function base64UrlEncode(bytes) {  let bin = '';  bytes.forEach(b => bin += String.fromCharCode(b));  const b64 = btoa(bin);  return b64.replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
}
function newProfileId() {  // 24 bytes -> ~32 chars base64url  const b = new Uint8Array(24);  crypto.getRandomValues(b);  return base64UrlEncode(b);
}
function getUrlId() {  const u = new URL(window.location.href);  const id = u.searchParams.get('id');  return id ? id.trim() : '';
}
function setUrlId(id) {  const u = new URL(window.location.href);  u.searchParams.set('id', id);  // keep hash route  history.replaceState({}, '', u.toString());
}
function exerciseDocId(name) {  const utf8 = new TextEncoder().encode(normName(name));  return base64UrlEncode(utf8);
}  /* State */
const state = {  authUid: null,  // firebase auth uid (anonymous)  profileId: null,  // URL-based profile id (shareable link)  current: null,  // {week, day}  currentPlan: null,  session: null,  // in[...]
};  function draftKey() {  return `wt_draft_v2_${firebaseConfig.projectId}_${state.profileId || 'noid'}`;
}
function loadDraft() { try { const raw = localStorage.getItem(draftKey()); return raw ? JSON.parse(raw) : null; } catch { return null; } }
function saveDraft(d) { try { localStorage.setItem(draftKey(), JSON.stringify(d)); } catch {} }
function clearDraft() { try { localStorage.removeItem(draftKey()); } catch {} }  /* Firestore paths (URL profile owns storage) */
function profDoc(path) { return doc(db, `profiles/${state.profileId}/${path}`); }
function profCol(path) { return collection(db, `profiles/${state.profileId}/${path}`); }  function draftDocRef() { return profDoc('state/draft'); }  async function loadCloudDraft() {  const snap = awa[...]
}  async function clearCloudDraft() {  try { await deleteDoc(draftDocRef()); } catch (e) { console.warn('delete draft failed', e); }
}  async function safeGetDoc(ref) {  try { return await getDoc(ref); } catch (e) { console.warn('getDoc failed', e); return null; }
}
async function safeGetDocs(q) {  try { return await getDocs(q); } catch (e) { console.warn('getDocs failed', e); return null; }
}  async function loadPointer() {  const ref = profDoc('state/current');  const snap = await safeGetDoc(ref);  if (snap && snap.exists()) {  const v = snap.data();  const week = Number(v.week) || 1;  [...]
}
async function savePointer(ptr) {  await setDoc(profDoc('state/current'), { week: ptr.week, day: ptr.day, updatedAt: serverTimestamp() }, { merge: true });
}  async function getExerciseIndex(exerciseName) {  const id = exerciseDocId(exerciseName);  const ref = profDoc(`exerciseIndex/${id}`);  const snap = await safeGetDoc(ref);  if (!snap || !snap.exists[...]
}  /* Render */
async function renderHome() {  const ptr = state.current;  const plan = state.currentPlan;  const draftLocal = loadDraft();  const draftCloud = state.cloudDraft;  const isLocalResumable = !!draftLocal[...]
}  async function renderWorkout() {  const plan = state.currentPlan;  if (!plan) {  screens.workout.innerHTML = `<div class="h2">Workout</div><p class="sub">Pick a week/day first.</p>`;  return;  }  i[...]
      const plannedLabel = (ex.plannedExercise && performed && performed !== ex.plannedExercise) ? `Planned: ${ex.plannedExercise} • ` : '';  try {  const idx = await getExerciseIndex(performed);  l[...]
      const hasSubs = !!(ex.sub1 || ex.sub2);
      const subIcon = `<button class=\"iconBtn\" data-action=\"sub\" data-ex=\"${i}\" title=\"Substitute\" ${hasSubs?'' : 'disabled'}>✎</button>`;  const subs = [ex.sub1, ex.sub2].filter(Boolean).jo[...]
      const restDisplay = restSec ? (Math.round(restSec/60) === (restSec/60) ? `${restSec/60} min` : fmtTime(restSec)) : (ex.rest || '—');  return `  <div class="exerciseCard">  <div class="exercise[...]
</div>  <table class="setTable">  <thead>  <tr>  <th style="width:28px">Set</th>  <th style="width:90px">Target</th>  <th>Guidance</th>  <th style="width:100px">Weight</th>  <th style="width:80px">Rep[...]
</div>
${ex.notes ? `<div class="note"><span class="smallMuted">Coach’s Note:</span> ${ex.notes}</div>` : ''}  <div class="miniBtns" id="timerRow-${i}" style="display:none;">  <span class="pill"><strong>Re[...]
}  function buildChartSvg(points) {  if (!points.length) return `<div class="sub">No data yet. Log a few sessions and your chart will appear here.</div>`;  const w = 360, h = 140, pad = 20;  const ys [...]
}  async function renderExercise() {  const exName = state.selectedExercise;  if (!exName) {  const q = query(profCol('exerciseIndex'), orderBy('updatedAt', 'desc'), limit(50));  const snap = await sa[...]
}  async function renderProgram() {  const weeks = Object.values(PROGRAM.weeks || {}).sort((a,b)=>a.week-b.week);  const weekRows = weeks.map(w => `  <div class="listItem">  <div>  <div style="font-we[...]
}  async function render() {  const route = (window.location.hash || '#home').replace('#','') || 'home';  if (['home','workout','exercise','program'].includes(route)) setRoute(route);  if (state.curre[...]
}  /* Picker modal */
function openPicker() {  const modal = $('#modal-picker');  modal.style.display = 'flex';  const pickWeek = $('#pickWeek');  const pickDay = $('#pickDay');  const weeks = Object.values(PROGRAM.weeks |[...]
}
function closePicker() { $('#modal-picker').style.display = 'none'; }
$('#pickerClose').addEventListener('click', closePicker);
$('#pickerCancel').addEventListener('click', closePicker);
$('#pickerApply').addEventListener('click', async () => {  const week = Number($('#pickWeek').value);  const day = Number($('#pickDay').value);  let ptr = { week, day };  if (isRestDay(ptr.week, ptr.d[...]
});  /* Substitute modal *//* Substitute modal */
let subCtx = null;
function openSubModal(exIndex) {  const ex = state.session.exercises[exIndex];  subCtx = { exIndex };  $('#modal-sub').style.display = 'flex';  $('#subTitle').textContent = `Substitute • ${ex.planne[...]
}
function closeSubModal() { $('#modal-sub').style.display = 'none'; subCtx = null; }
$('#subClose').addEventListener('click', closeSubModal);
$('#subCancel').addEventListener('click', closeSubModal);
$('#subApply').addEventListener('click', async () => {  if (!subCtx) return;  const ex = state.session.exercises[subCtx.exIndex];  const chosen = decodeURIComponent($('#subSelect').value || encodeURIC[...]
});  /* Rest timers */
const restTimers = new Map();
function startRestTimer(exIndex, restSecondsStr) {  const sec = Number(restSecondsStr);  if (!Number.isFinite(sec) || sec <= 0) { showToast('No rest duration for this exercise.'); return; }  stopRestT[...]
}
function stopRestTimer(exIndex) {  const id = restTimers.get(exIndex);  if (id) clearInterval(id);  restTimers.delete(exIndex);  const row = $(`#timerRow-${exIndex}`);  if (row) row.style.display = 'n[...]
}  /* Copy behaviors */
async function doCopyLastSet(exIndex) {  const ex = state.session.exercises[exIndex];  let targetSet = ex.sets.findIndex(s => !normName(s.weight) || !normName(s.reps));  if (targetSet < 0) targetSet =[...]
}
async function doCopyLastWorkout(exIndex) {  const ex = state.session.exercises[exIndex];  const performed = ex.performedExercise || ex.plannedExercise;  const idx = await getExerciseIndex(performed);[...]
}  let _cloudDraftTimer = null;
let _lastCloudDraftHash = '';  function _hashDraft(obj) {  // Lightweight stable hash: JSON string (good enough for single-user drafts)  try { return JSON.stringify(obj); } catch { return String(Date.[...]
}  function scheduleCloudDraftSave() {  if (!state.session) return;  clearTimeout(_cloudDraftTimer);  _cloudDraftTimer = setTimeout(saveCloudDraftNow, 650);  draftUi.state = 'saving';  draftUi.lastErr[...]
}  async function saveCloudDraftNow() {  if (!state.session) return;  const s = state.session;  const payload = {  version: 1,  profileId: state.profileId,  week: s.week,  day: s.day,  block: s.block,[...]
}  function persistSessionDraft() {  if (!state.session) return;  saveDraft({  version: 2,  profileId: state.profileId,  week: state.session.week,  day: state.session.day,  workout: state.session.work[...]
}  async function startOrResumeWorkout() {  const plan = state.currentPlan;  if (!plan || plan.isRest) return;  const dLocal = loadDraft();  if (dLocal && dLocal.week === plan.week && dLocal.day === p[...]
}  async function finishWorkout() {  if (!state.session || !state.currentPlan) return;  const plan = state.currentPlan;  const s = state.session;  const hasAny = s.exercises.some(ex => ex.sets.some(st[...]
}  const BUILD_ID = 'v2.3-draft-20251216050705Z';  /* Auth bootstrap */
async function bootstrap() {  // Create/ensure URL profile id first (so all reads/writes use it)  let pid = getUrlId();  if (!pid) {  pid = newProfileId();  setUrlId(pid);  }  state.profileId = pid;  [...]
}
bootstrap();
window.addEventListener('hashchange', render);
</script>
</body>
</html>
